# 2.2 Архитектура программной системы

Архитектура разрабатываемой системы распознавания лиц основана на принципах модульного программирования и разделения ответственности между компонентами. Система построена по многоуровневой архитектуре, которая обеспечивает четкое разделение бизнес-логики, уровня данных и пользовательского интерфейса.

Общая архитектура системы включает четыре основных уровня. Уровень представления отвечает за взаимодействие с пользователем и реализован в виде графического интерфейса на основе библиотеки tkinter. Уровень бизнес-логики содержит основные алгоритмы распознавания лиц, управления камерой и обработки данных. Уровень данных обеспечивает хранение и извлечение информации о пользователях и событиях безопасности. Уровень аудита реализует сквозную функциональность протоколирования всех операций системы.

Модульная структура приложения организована в виде пакетов, каждый из которых отвечает за определенную область функциональности. Пакет core содержит ядро системы с основными компонентами для работы с данными, камерой и алгоритмами распознавания. Пакет gui включает все компоненты пользовательского интерфейса и логику взаимодействия с пользователем. Пакет audit реализует систему протоколирования событий безопасности. Пакет config содержит централизованные настройки системы.

Компонент DatabaseManager представляет собой основной интерфейс для работы с базой данных пользователей. Данный модуль инкапсулирует всю логику взаимодействия с SQLite, обеспечивая операции создания, чтения, обновления и удаления записей пользователей. Менеджер базы данных также отвечает за сериализацию и десериализацию биометрических отпечатков лиц, преобразуя многомерные массивы признаков в формат, пригодный для хранения в реляционной базе данных.

```python
class DatabaseManager:
    def __init__(self, db_name=USERS_DB):
        self.db_name = db_name
        self.initialize_database_structure()
    
    def add_user(self, user_id, name, photo_path, face_encoding=None):
        connection = sqlite3.connect(self.db_name)
        cursor = connection.cursor()
        
        encoding_blob = None
        if face_encoding is not None:
            encoding_blob = pickle.dumps(face_encoding)
        
        cursor.execute('''
            INSERT INTO users (user_id, name, photo_path, face_encoding) 
            VALUES (?, ?, ?, ?)
        ''', (user_id, name, photo_path, encoding_blob))
```

Компонент FaceAnalysisEngine реализует центральную логику анализа и распознавания лиц. Движок анализа использует библиотеку face_recognition для извлечения биометрических признаков и выполнения сравнений. Компонент поддерживает в памяти базу зарегистрированных пользователей для обеспечения высокой скорости распознавания в режиме реального времени. Алгоритм распознавания включает этапы обнаружения лиц на изображении, извлечения 128-мерных векторов признаков и сравнения с эталонными данными.

Компонент CameraController обеспечивает абстракцию над функциями видеозахвата операционной системы. Контроллер камеры управляет жизненным циклом подключения к устройству, настройкой параметров захвата и получением кадров для обработки. Реализация следует принципу получения ресурса при инициализации для обеспечения корректного освобождения системных ресурсов при завершении работы.

Система аудита безопасности построена как отдельный архитектурный слой, который интегрируется с основными компонентами через механизм внедрения зависимостей. SecurityAuditLogger обеспечивает централизованное протоколирование всех событий системы в отдельную базу данных. Компонент SecurityAuditIntegration реализует паттерн интегратора, обеспечивая бесшовное встраивание функций аудита в существующие модули без нарушения их основной логики.

Пользовательский интерфейс реализован по паттерну составного объекта (Composite), где главное приложение FaceRecognitionSystem выступает в роли контейнера для специализированных виджетов. Каждый виджет отвечает за определенную функциональную область и может быть разработан и тестирован независимо от других компонентов интерфейса.

FaceRecognitionWidget реализует интерфейс для работы с видеопотоком и отображения результатов распознавания. Виджет управляет циклом обработки кадров, визуализацией обнаруженных лиц и отображением информации о распознанных пользователях. Реализация использует неблокирующий подход к обработке видео через механизм планировщика событий tkinter.

UserManagementWidget предоставляет полнофункциональный интерфейс для управления базой пользователей. Виджет включает формы для ввода данных новых пользователей, предварительный просмотр загружаемых фотографий, таблицу существующих пользователей и элементы управления для редактирования и удаления записей. Все операции сопровождаются проверкой входных данных и обратной связью о результатах выполнения.

SecurityAuditWidget реализует интерфейс мониторинга безопасности системы. Виджет отображает статистическую информацию о работе системы в режиме реального времени, подробный журнал событий и предоставляет возможности экспорта данных аудита. Обновление информации происходит автоматически через заданные интервалы времени.

Взаимодействие между компонентами организовано через четко определенные интерфейсы и механизм обратных вызовов. Основные компоненты не имеют прямых зависимостей друг от друга, что обеспечивает слабую связанность и возможность независимого тестирования. Передача данных между уровнями осуществляется через параметры методов и возвращаемые значения, что исключает использование глобальных переменных и повышает предсказуемость поведения системы.

Система конфигурации реализована в виде централизованного модуля settings, который содержит все настраиваемые параметры системы. Такой подход позволяет легко адаптировать поведение системы под различные условия эксплуатации без модификации исходного кода основных компонентов. Настройки включают параметры алгоритмов распознавания, временные интервалы, размеры интерфейса и пути к файлам данных.