# 2.3 Проектирование базы данных

Проектирование структуры базы данных для системы распознавания лиц требует учета специфики хранения биометрических данных и обеспечения высокой производительности операций поиска и сравнения. Система использует реляционную модель данных, реализованную средствами SQLite, что обеспечивает локальное хранение без необходимости развертывания внешнего сервера базы данных.

Концептуальная модель данных основана на разделении информации на две основные предметные области: данные пользователей и события безопасности. Такое разделение позволяет оптимизировать структуру хранения под различные типы операций и обеспечивает возможность независимого масштабирования каждой части системы.

База данных пользователей содержит таблицу users, которая хранит всю информацию о зарегистрированных в системе пользователях. Структура таблицы включает поле id как автоинкрементный первичный ключ, обеспечивающий уникальную идентификацию каждой записи. Поле user_id содержит пользовательский идентификатор, который должен быть уникальным в рамках системы и используется для связывания событий аудита с конкретными пользователями.

```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT UNIQUE NOT NULL,
    name TEXT NOT NULL,
    photo_path TEXT,
    face_encoding BLOB
);
```

Поле name хранит отображаемое имя пользователя, которое используется в интерфейсе системы для представления результатов распознавания. Поле photo_path содержит путь к файлу фотографии пользователя в файловой системе, что позволяет отображать изображения в интерфейсе управления пользователями. Наиболее критичным является поле face_encoding, которое содержит сериализованные биометрические характеристики лица пользователя.

Хранение биометрических отпечатков реализовано через сериализацию 128-мерных векторов признаков в двоичный формат с использованием библиотеки pickle. Такой подход обеспечивает точное сохранение числовых данных с плавающей точкой, необходимых для корректного функционирования алгоритмов сравнения. Двоичное представление также обеспечивает компактность хранения по сравнению с текстовыми форматами.

База данных аудита содержит таблицу security_events, предназначенную для хранения всех событий безопасности системы. Структура таблицы разработана с учетом требований к полноте протоколирования и возможности последующего анализа данных аудита. Первичный ключ id обеспечивает уникальность и упорядоченность записей событий.

```sql
CREATE TABLE security_events (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp TEXT NOT NULL,
    event_type TEXT NOT NULL,
    user_id TEXT,
    result TEXT NOT NULL,
    distance REAL
);
```

Поле timestamp содержит временную метку события в формате ISO 8601, что обеспечивает стандартизированное представление времени и возможность точной хронологической сортировки событий. Использование текстового формата для хранения времени упрощает экспорт данных и обеспечивает читаемость журналов без дополнительного преобразования.

Поле event_type определяет категорию события безопасности и принимает значения из предопределенного множества. Основными типами событий являются попытки распознавания лиц, операции управления пользователями и системные события. Стандартизация типов событий обеспечивает возможность автоматического анализа и построения отчетов по категориям активности.

Поле user_id содержит ссылку на идентификатор пользователя, связанного с событием. Для системных событий, не связанных с конкретным пользователем, данное поле может содержать значение NULL. Такая структура обеспечивает возможность построения отчетов как по общей активности системы, так и по действиям конкретных пользователей.

Поле result фиксирует результат выполнения операции и принимает значения "success" или "failed". Это позволяет анализировать эффективность работы системы и выявлять потенциальные проблемы безопасности, такие как многократные неудачные попытки доступа.

Поле distance содержит числовое значение расстояния схожести для операций биометрического распознавания. Данный параметр позволяет анализировать качество распознавания и настраивать пороговые значения для оптимизации баланса между точностью и полнотой идентификации. Для событий, не связанных с распознаванием лиц, данное поле содержит значение NULL.

Индексация таблиц спроектирована для обеспечения высокой производительности наиболее частых операций. Для таблицы пользователей создается уникальный индекс по полю user_id, что обеспечивает быстрый поиск пользователей по идентификатору и предотвращает дублирование записей. Для таблицы событий безопасности создаются составные индексы по временным меткам и типам событий для оптимизации операций построения отчетов и фильтрации данных.

```sql
CREATE INDEX idx_timestamp ON security_events(timestamp);
CREATE INDEX idx_event_type ON security_events(event_type);
CREATE INDEX idx_user_id ON security_events(user_id);
```

Ограничения целостности данных обеспечивают корректность информации в базе данных. Уникальность пользовательских идентификаторов гарантируется ограничением UNIQUE на поле user_id таблицы users. Обязательность заполнения ключевых полей обеспечивается ограничениями NOT NULL для полей, критичных для функционирования системы.

Стратегия резервного копирования предполагает создание копий файлов базы данных через регулярные интервалы времени. Поскольку SQLite хранит данные в виде файлов, резервное копирование может выполняться стандартными средствами файловой системы. Для обеспечения согласованности данных резервное копирование должно выполняться при отсутствии активных транзакций записи.

Миграция структуры базы данных реализована через проверку существования таблиц и создание недостающих элементов при инициализации системы. Такой подход обеспечивает автоматическое обновление структуры данных при развертывании новых версий системы без необходимости ручного вмешательства администратора.

Оптимизация производительности включает использование транзакций для группировки связанных операций и минимизации количества обращений к диску. Операции чтения биометрических данных оптимизированы через загрузку всех активных отпечатков в оперативную память при старте системы, что исключает необходимость обращения к базе данных при каждой операции распознавания.

Безопасность данных обеспечивается средствами файловой системы через ограничение прав доступа к файлам базы данных. Дополнительная защита может быть реализована через шифрование файлов базы данных средствами операционной системы или специализированными версиями SQLite с поддержкой шифрования.